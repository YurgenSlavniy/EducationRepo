1) c:\django> python -m venv .venv - установка виртуальной среды
2) c:\django> source .venv\Scripts\activate.bat - активация виртуальной среды
3) c:\django> python -m pip install Django - установка Джанго
4) c:\django> django-admin startproject project_name - создание проекта Джанго
5) c:\django> cd project_name - переходим в сзданный проект
6) c:\django\project_name> python manage.py runserver - запуск сервера с приложением
7) c:\django\project_name> python manage.py startapp app_name - создание приложения
8) c:\django\project_name> python manage.py runserver - запуск сервера



# Введение в Django #
## 1.1 Что такое Django ##
Django - это фреймворк для создания веб-приложений с помощью языка программирования Python.

Django был создан в 2005 году, когда веб-разработчики из газеты Lawrence Journal-World стали использовать Python в качестве языка для создания веб-сайтов. А в 2008 году вышел публичный первый релиз фреймворка. На сегодняшний день он продолжает развиваться. Так, текущей версией фреймворка на момент написания этой статьи является версия 4.1, которая вышла в августе 2022 года. Каждый новый релиз фреймворка выходит в средним каждые 8 месяцев. Кроме того, постоянно выходят обновления и исправления в безопасности.

Django довольно популярен. Он используется на многих сайтах, в том числе таких, как Pinterest, PBS, Instagram, BitBucket, Washington Times, Mozilla и многих других.

Фреймворк является бесплатным. Он развивается как open source, его исходный код открыт, его можно найти репозитории на githube.

На Django можно создавать широкий диапазон веб-приложений: от небольших персональных сайтов до высоконагруженных сложных веб-сервисов.

Django по умолчанию предлагает готовую функциональность для ряда распространенных задач, например, систему аутентификации, генерацию карт сайта и т.д., благодаря чему нам можно не изобретать велосипед и достаточно взять уже готовые компоненты.

В Django большое внимание уделяется безопасности, благодаря чему фреймворк помогает разработчикам избежать многих распространенных проблем в системе безопасности, например, sql-инъекций.

Фреймворк Django реализует архитектурный паттерн Model-View-Template или сокращенно MVT, который по факту является модификацией распростаненного в веб-программировании паттерна MVC (Model-View-Controller).

### Архитектура MVT в Django ###
Основные элементы паттерна:

- URL dispatcher: при получение запроса на основании запрошенного адреса URL определяет, какой ресурс должен обрабатывать данный запрос.

- View: получает запрос, обрабатывает его и отправляет в ответ пользователю некоторый ответ. Если для обработки запроса необходимо обращение к модели и базе данных, то View взаимодействует с ними. Для создания ответа может применять Template или шаблоны. В архитектуре MVC этому компоненту соответствуют контроллеры (но не представления).

- Model: описывает данные, используемые в приложении. Отдельные классы, как правило, соответствуют таблицам в базе данных.

- Template: представляет логику представления в виде сгенерированной разметки html. В MVC этому компоненту соответствует View, то есть представления.

Когда к приложению приходит запрос, то URL dispatcher определяет, с каким ресурсом сопоставляется данный запрос и передает этот запрос выбранному ресурсу. Ресурс фактически представляет функцию или View, который получает запрос и определенным образом обрабатывает его. В процессе обработки View может обращаться к моделям и базе данных, получать из нее данные, или, наоборот, сохранять в нее данные. Результат обработки запроса отправляется обратно, и этот результат пользователь видит в своем браузере. Как правило, результат обработки запроса представляет сгенерированный html-код, для генерации которого применяются шаблоны (Template).

## 1.2 Установка и настройка Django ##
Перед началом работы с Django нам естественно надо установить интерпретатор Python.

Существуют разные способы установки Django. Рассмотрим рекомендуемый способ.

### Пакетный менеджер pip ###
Пакеты Django размещаются в центральном репозитории для большинства пакетов Python - Package Index (PyPI). И для установки из этого репозитория нам потребуется пакетный менеджер pip. Менеджер pip позволяет загружать пакеты и управлять ими. Обычно при установке python также устанавливается и менеджер pip. В этом случае мы можем проверить версию менеджера, выполнив в командной строке/терминале команду pip -V (V - с заглавной буквы):
```cmd
C:\Users\eugen>pip -V
pip 22.0.4 from C:\Users\eugen\AppData\Local\Programs\Python\Python310\lib\site-packages\pip (python 3.10)

C:\Users\eugen>
```
Если pip не установлен, то мы увидим ошибку типа
```
"pip" не является внутренней или внешней командой, исполняемой программой или пакетным файлом
```
В этом случае нам надо установить pip. Для этого можно выполнить в командной строке/консоли следующую команду:
```cmd
python -m ensurepip --upgrade
```
Если pip ранее уже был установлен, то можно его обновить с помощью команды
```cmd
pip install --upgrade pip
```
### Установка виртуальной среды ###
Виртуальная среда или venv не является неотъемлимой частью разработки на Django. Однако ее рекомендуется использовать, так как она позволяет создать множество виртуальных сред Python на одной операционной системе. Благодаря виртуальной среде приложение может запускаться независимо от других приложений на Python.

В принципе можно запускать приложения на Django и без виртуальной среды. В этом случае все пакеты Django устанавливаются глобально. Однако что если после создания первого приложения выйдет новая версия Django? Если мы захотим использовать для второго проекта новую версию Django, то из-за глобальной установки пакетов придется обновлять первый проект, который использует старую версию. Это потребует некоторой дополнительной работы по обновлению, так как не всегда соблюдается обратная совместимость между пакетами. Если мы решим использовать для второго проекта старую версию, то мы лишиемся потенциальных преимуществ новой версии. И использование виртуальной среды как раз позволяет разграничить пакеты для каждого проекта.

Для работы с виртуальной средой в python применяется встроенный модуль venv

Итак, создадим вируальную среду. Вначале определим каталог для проектов django. Например, пусть это будет каталог C:\django. Прежде всего перейдем в терминале/командной строке в этот каталог с помощью команды cd.
```cmd
cd C:\django
```
Затем для создания виртуальной среды выполним следующую команду:
```cmd
python -m venv .venv
```
Модулю venv передается название среды, которая в данном случае будет называться ".venv". Для наименования виртуальных сред нет каких-то определенных условностей. Пример консольного вывода:
```cmd
C:\Users\eugen>cd C:\django
```
Переход к папке будущей виртуальной среды
```cmd
C:\django>python -m venv .venv
```
Создание виртуальной среды
```cmd
C:\django>
```
После этого в текущей папке (C:\django) будет создан подкаталог ".venv".

### Активация виртуальной среды ###
Для использования виртуальную среду надо активировать. И каждый раз, когда мы будем работать с проектом Django, связанную с ним виртуальную среду надо активировать. Например, активируем выше созданную среду, которая располагается в текущем каталоге в папке .venv. Процесс активации немного отличается в зависимости от операционной системы и от того, какие инструменты применяются. Так, в Windows можно использовать командную строку и PowerShell, но между ними есть отличия.

### Активация в Windows в коммандной строке ###
Если наша ОС - Windows, то в папке .venv/Scripts/ мы можем найти файл activate.bat, который активирует виртуальную среду. Так, в Windows активация виртуальной среды в коммандной строке будет выглядеть таким образом:
```cmd
.venv\Scripts\activate.bat
```
### Активация в Windows в PowerShell ###
Также при работе на Windows в папке .venv/Scripts/ мы можем найти файл activate.ps1 который также активирует виртуальную среду, но применяется только в PowerShell. Но при работе с PowerShell следует учитывать, что по умолчанию в этой оболочке запрещено применять скрипты. Поэтому перед активацией среды необходимо установить разрешения для текущего пользователя. Поэтому для активации виртуальной среды в PowerShell необходимо выполнить две следующих команды:
```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
.venv\Scripts\Activate.ps1
```
### Активация в Linux и MacOS ###
Для Linux и MacOS активация будет производиться с помощью следующей команды:
```terminal
source .venv/bin/activate
```
Далее я буду приводить примеры на основе командной строки Windows, однако все остальные примеры не будут зависеть от того, что используется - PowerShell или командная строка, Windows, Linux или MacOS. В любом случае после успешной активации слева от текущего каталога мы увидим в скобках название виртуальной среды:
```terminal
C:\Users\eugen>cd C:\django

C:\django>python -m venv .venv

C:\django>.venv\Scripts\activate.bat
```
Активация виртуальной среды
```
(.venv) C:\django>
```
Виртуальная среда активирована

## Установка Django ##
После активации виртуальной среды для установки Django выполним в консоли следующую команду
```cmd
python -m pip install Django
```
Она устанавливает последнюю версию Django.
```
(.venv) C:\django>python -m pip install Django
Collecting Django
  Using cached Django-4.1-py3-none-any.whl (8.1 MB)
Collecting sqlparse>=0.2.2
  Using cached sqlparse-0.4.2-py3-none-any.whl (42 kB)
Collecting tzdata
  Using cached tzdata-2022.1-py2.py3-none-any.whl (339 kB)
Collecting asgiref<4,>=3.5.2
  Using cached asgiref-3.5.2-py3-none-any.whl (22 kB)
Installing collected packages: tzdata, sqlparse, asgiref, Django
Successfully installed Django-4.1 asgiref-3.5.2 sqlparse-0.4.2 tzdata-2022.1

(.venv) C:\django>
```
Если нам интересует конкретная версия Django, то мы можем указать ее при установке:
```cmd
python -m pip install django~=4.0.0
```
### Проверка установки ###
Чтобы убедиться, что все установлено правильно, мы можем перейти к интерпретатору python. Для этого введем в терминале команду
```
python
```
И затем выполним последовательно следующие две инструкции:
```
>>> import django
>>> print(django.get_version())
```
Консольный вывод в моем случае:
```
(.venv) C:\django>python
Python 3.10.1 (tags/v3.10.1:2cd268a, Dec  6 2021, 19:10:37) [MSC v.1929 64 bit (AMD64)] on win32
Type "help", "copyright", "credits" or "license" for more information.
>>> import django
>>> print(django.get_version())
4.1
>>>
```
### Деактивация виртуальной среды ###
После окончания работы с виртуальной средой мы можем ее деактивировать с помощью команды:
```cmd
deactivate
```
## 1.3 Создание первого проекта ##
django-admin предоставляет ряд команд для управления проектом Django. В частности, для создания проекта применяется команда startproject. Этой команде в качестве аргумента передается название проекта.

Итак, создадим первый на Django. Пусть он будет располагаться в той же папке, где располагается каталог виртуальной среды. И для этого вначале активируем ранее созданную виртуальную среду (например, среду .venv, которая была создана в прошлой теме, если она ранее не была активирована).

И после активации виртуальной среды выполним следующую команду
```cmd
c:\django>django-admin startproject metanit
```
В данном случае мы создаем проект с именем "metanit". И после выполнения этой команды в текущей папке (c:\django) будет создан каталог metanit.

Созданный каталог будет состоять из следующих элементов:

- manage.py: выполняет различные команды проекта, например, создает и запускает приложение

- metanit - собственно папка проекта metanit, которая содержит следующие файлы:

- metanit/__init__.py: данный файл указывает, что папка, в которой он находится, будет рассматриваться как модуль. Это стандартный файл для программы на языке Python.

- metanit/settings.py: содержит настройки конфигурации проекта

- metanit/urls.py: содержит шаблоны URL-адресов, по сути определяет систему маршрутизации проекта

- metanit/wsgi.py: содержит свойства конфигурации WSGI (Web Server Gateway Inerface). Он используется при развертывании проекта.

- metanit/asgi.py: название файла представляет сокращение от Asynchronous Server Gateway Interface и расширяет возможности WSGI, добавляя поддержку для взаимодействия между асинхронными веб-серверами и приложениями.

Запустим проект на выполнение. Для этого с помощью команды cd перейдем в консоли к папке проекта.
```cmd
cd metanit
```
И затем для запуска проекта выполним следующую команду:
```
python manage.py runserver
```

После запуска проекта в консоли мы увидим адрес, по которому запущен проект. Как правило, это адрес http://127.0.0.1:8000/. Откроем любой веб-браузер и введем данный адрес в адресную строку браузера. И нам откроется содержимое по умолчанию.

## 1.4 Создание первого приложения ##
Веб-приложение или проект Django состоит из отдельных приложений. Вместе они образуют полноценное веб-приложение. Каждое приложение представляет какую-то определенную функциональность или группу функциональностей. Один проект может включать множество приложений. Это позволяет выделить группу задач в отдельный модуль и разрабатывать их относительно независимо от других. Кроме того, мы можем переносить приложение из одного проекта в другой независимо от другой функциональности проекта.

При создании проекта он уже содержит несколько приложений по умолчанию.

- django.contrib.admin

- django.contrib.auth

- django.contrib.contenttypes

- django.contrib.sessions

- django.contrib.messages

- django.contrib.staticfiles

Список всех приложений можно найти в проекте в файле settings.py в переменной INSTALLED_APPS:
```python
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
]
```
И, конечно, мы можем создавать свои приложения, которые реализуют определенный функционал. Для создания приложения в проекте применяется команда
```cmd
python manage.py startapp название_проекта
```
Так, создадим в проекте, созданном в прошлой теме или новом, первое приложение, которое будет называться hello. Для этого выполним в командной строке/терминале следующую команду:
```cmd
python manage.py startapp hello
```

В результате в проекте Django будет создано приложение hello. И после выполнения этой команды мы увидим в проекте новую папку, которое будет хранить все файлы созданного приложения. Рассмотрим вкратце его структуру:

- папка migrations: предназначена для хранения миграций - скриптов, которые позволяют синхронизировать структуру базы данных с определением моделей

- __init__.py: указывает интерпретатору python, что текущий каталог будет рассматриваться в качестве пакета

- admin.py: предназначен для административных функций, в частности, здесь призводится регистрация моделей, которые используются в интерфейсе администратора

- apps.py: определяет конфигурацию приложения

- models.py: хранит определение моделей, которые описывают используемые в приложении данные

- tests.py: хранит тесты приложения

- views.py: определяет функции, которые получают запросы пользователей, обрабатывают их и возвращают ответ

Но пока приложение никак не задействуется. Его надо зарегистрировать в проекте Django. Для этого откроем файл settings.py и добавим в конец массива INSTALLED_APPS наше приложение:
```python
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'hello'
]
```
В проекте может быть несколько приложений, и каждое из них надо добавлять таким вот образом.

Теперь определим какие-нибудь простейшие действия, которые будет выполнять данное приложение, например, отправлять в ответ пользователю строку "Hello World".

Для этого перейдем в проекте приложения hello к файлу views.py, который по умолчанию должен выглядеть следующим образом:
```python 
from django.shortcuts import render
# Create your views here.
```
Изменим код следующим образом:
```python
from django.http import HttpResponse
  
def index(request):
    return HttpResponse("Hello METANIT.COM")
```
В данном случае мы импортируем класс HttpResponse из стандартного пакета django.http. Затем определяется функция index(), которая в качестве параметра получает объект запроса request. Класс HttpResponse предназначен для создания ответа, который отправляется пользователю. И с помощью выражения return HttpResponse("Hello METANIT.COM") мы отправляем пользователю строку "Hello METANIT.COM"

Теперь также в основном проекте Django откроем файл urls.py, который позволяет сопоставить маршруты с представлениями, которые будут обрабатывать запрос по этим маршрутам. По умолчанию этот файл выглядит следующим образом:
```python
from django.contrib import admin
from django.urls import path
 
urlpatterns = [
    path('admin/', admin.site.urls),
]
```
Первой строкой из модуля django.contrib импортируется класс AdminSite, который предоставляет возможности работы с интерфейсом администратора. Второй строкой из модуля django.urls импортируется функция path. Эта функция задает сопоставление определенного маршрута с функцией обработки. Так, в данном случае маршрут "admin/" будет обрабатываться методом admin.site.urls.

Но выше мы определили функцию index в файле views.py, который возвращает пользователю строку "Hello METANIT.COM". Поэтому изменим файл urls.py следующим образом:
```python
from django.urls import path
from hello import views
 
urlpatterns = [
    path('', views.index, name='home'),
]
```
Чтобы использовать функцию views.index вначале импортируем модуль views. Затем определяем сопоставление маршрута ' ' и функции views.index и также дополнительно имя для маршрута: name='home'. По сути маршрут ' ' будет сопоставляться с запросом к корню приложения.

Теперь снова запустим приложение командой
```
python manage.py runserver
```
И вновь перейдем в браузере по адресу http://127.0.0.1:8000/, и браузер нам отобразит строку "Hello METANIT.COM"
